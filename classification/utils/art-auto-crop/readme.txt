The main contours.py file:
https://gist.github.com/ilyakava/b2dbca43991d6c668dbb#file-contours-py-L1

For cropping after contours.py has run:
https://gist.github.com/ilyakava/3927eb5d702f17b42607

Some helper functions:
https://gist.github.com/ilyakava/2925947a615610410922
https://gist.github.com/ilyakava/1bd862bd6b6c16f9cdab